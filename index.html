<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rating Widget</title>
<style>
  :root {
    --star-size: 30px; /* Size of stars */
    --star-color-unselected: gray; /* Color of unselected stars */
    --star-color-selected: gold; /* Color of selected stars */
    --star-color-hover: orange; /* Color of stars on hover */
  }

  #star-rating {
    cursor: pointer;
    font-size: var(--star-size);
  }

  .star {
    color: var(--star-color-unselected);
    display: inline-block;
    transition: color 0.2s; /* Smooth transition for color change */
  }

  /* Hover effect */
  .star:hover, .star:hover ~ .star {
    color: var(--star-color-hover);
  }

  .star.selected {
    color: var(--star-color-selected);
  }
  
  /* Hide the JS-generated stars initially */
  .js-rating {
    display: none;
  }
</style>
</head>
<body>

<rating-widget>
  <form id="rating-form" action="https://httpbin.org/post" method="POST">
    <label for="symbol-select">Choose a symbol:</label>
    <select id="symbol-select">
      <option value="★">Star</option>
      <option value="●">Circle</option>
      <option value="▲">Triangle</option>
    </select>

    <label for="rating">How satisfied are you?</label>
    <input type="hidden" name="question" value="How satisfied are you?">
    <input type="hidden" name="sentBy" value="HTML">
    <div id="star-rating" class="js-rating"></div>
    <noscript>
      <select name="rating" id="rating" required>
        <option value="" selected disabled>Choose a rating</option>
        <option value="1">1 Star</option>
        <option value="2">2 Stars</option>
        <option value="3">3 Stars</option>
        <option value="4">4 Stars</option>
        <option value="5">5 Stars</option>
      </select>
    </noscript>
    <button type="submit">Submit</button>
  </form>
</rating-widget>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('rating-form');
    const symbolSelect = document.getElementById('symbol-select');
    const starRatingEl = document.getElementById('star-rating');
    const noscriptRating = document.querySelector('noscript select');
    const maxRating = 5;

    // Function to create rating symbols
    function createRatingSymbols(selectedSymbol) {
      starRatingEl.innerHTML = ''; // Clear existing symbols
      for (let i = 1; i <= maxRating; i++) {
        const symbolEl = document.createElement('span');
        symbolEl.classList.add('star');
        symbolEl.dataset.ratingValue = i;
        symbolEl.textContent = selectedSymbol; // Use the selected symbol
        starRatingEl.appendChild(symbolEl);
      }
    }

    // Function to update the display of the symbols based on the selected rating
    function updateSymbols(ratingValue) {
      const stars = document.querySelectorAll('#star-rating .star');
      stars.forEach((star, index) => {
        star.classList.toggle('selected', index < ratingValue);
      });
    }

    // Initially create the rating symbols
    createRatingSymbols(symbolSelect.value);

    // Show the JS rating stars and hide the noscript rating
    starRatingEl.style.display = 'inline-block';
    if (noscriptRating) {
      noscriptRating.style.display = 'none';
    }

    // Attach event listeners to stars for interaction
    starRatingEl.addEventListener('click', event => {
      if (event.target.classList.contains('star')) {
        const ratingValue = event.target.dataset.ratingValue;
        updateSymbols(ratingValue);
        // Store the rating value in a hidden input to be submitted with the form
        const ratingInput = document.createElement('input');
        ratingInput.type = 'hidden';
        ratingInput.name = 'rating';
        ratingInput.value = ratingValue;
        form.appendChild(ratingInput);
      }
    });

    // Event listener for symbol selection change
    symbolSelect.addEventListener('change', function() {
      createRatingSymbols(this.value);
    });

    // Event listener for form submission
    form.addEventListener('submit', function(event) {
      event.preventDefault(); // Prevent the default form submission

      const formData = new FormData(form);
      formData.append('sentBy', 'JS'); // Indicate that the form was sent by JavaScript

      // Send the form data using fetch
      fetch(form.action, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        console.log('Response:', data); // Log the response to the console
        // Show a thank you message or handle the response
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });
  });
</script>
</body>
</html>
